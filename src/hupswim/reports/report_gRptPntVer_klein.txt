Version =20
VersionRequired =20
Checksum =2054698627
Begin Report
    LayoutForPrint = NotDefault
    DateGrouping =1
    GridX =15
    GridY =15
    Width =10922
    ItemSuffix =28
    Left =2610
    Top =585
    Right =11610
    Bottom =6570
    ShortcutMenuBar ="gShortcutRpt"
    Toolbar ="gRptToolbar"
    RecSrcDt = Begin
        0xc164f8047e2ee340
    End
    RecordSource ="SELECT [__punten].* FROM __punten;"
    OnOpen ="[Event Procedure]"
    MenuBar ="gMnBasic"
    PrtMip = Begin
        0x37020000530300001c0100005303000000000000ef130000f100000000000000 ,
        0x020000003702000000000000a20700000100000000000000
    End
    PrtDevMode = Begin
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x010402059c00c40253ef800101000900ea0a6f08640001000f00580202000100 ,
        0x5802030001004c65747465720000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000010000000000000001000000 ,
        0x0200000001000000000000000000000000000000000000000000000050524956 ,
        0xe230000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000180000000000102710271027 ,
        0x0000102700000000000000000000c40200000000000000000000000000000000 ,
        0x00000000000000000300000000000000000010005c4b03006843040000000000 ,
        0x000000000000010000000000000000000000000000000000e7b14b4c03000000 ,
        0x05000400ff000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000
    End
    PrtDevNames = Begin
        0x080013001e000100000000000000000000000000000000000000000000005044 ,
        0x4643726561746f723a00
    End
    Begin
        Begin Label
            FontSize =10
            FontName ="Arial"
        End
        Begin TextBox
            OldBorderStyle =0
            Width =1701
            LabelX =-1701
            FontSize =10
            FontName ="Arial"
        End
        Begin Subform
            OldBorderStyle =0
            Width =1701
            Height =1701
        End
        Begin BreakLevel
            ControlSource ="PT_Wedstrijdnummer"
        End
        Begin BreakLevel
            KeepTogether =1
            ControlSource ="=Val([pt_Programmanummer])"
        End
        Begin BreakLevel
            ControlSource ="PT_Is_InitVals"
        End
        Begin BreakLevel
            GroupHeader = NotDefault
            GroupFooter = NotDefault
            KeepTogether =2
            ControlSource ="pt_programmanummer"
        End
        Begin BreakLevel
            GroupHeader = NotDefault
            GroupFooter = NotDefault
            ControlSource ="PT_PNT_CatIdx"
        End
        Begin BreakLevel
            ControlSource ="PT_RankingCounter"
        End
        Begin BreakLevel
            ControlSource ="PT_Vereniging"
        End
        Begin FormHeader
            KeepTogether = NotDefault
            Height =539
            OnFormat ="[Event Procedure]"
            Name ="scRepHeader"
            Begin
                Begin TextBox
                    TextAlign =2
                    Top =31
                    Width =10896
                    Height =376
                    FontSize =12
                    FontWeight =700
                    Name ="fldTitle"
                End
            End
        End
        Begin PageHeader
            Height =0
            Name ="scPageHeader"
        End
        Begin BreakHeader
            KeepTogether = NotDefault
            Height =475
            BreakLevel =3
            OnFormat ="[Event Procedure]"
            Name ="scProgHeader"
            Begin
                Begin Label
                    Width =3570
                    Height =250
                    FontSize =8
                    FontWeight =700
                    Name ="lbTussenstand"
                    Caption ="Tussenstand "
                End
                Begin TextBox
                    Width =4656
                    Height =250
                    FontSize =8
                    FontWeight =700
                    Name ="fldProgDes"
                    ControlSource ="=\"Progr. nr. \" & [pt_programmanummer] & \"   \" & fmtProgDes_Kort(nz([pt_type]"
                        "),nz([pt_beschrijving_afwijkend]),[pt_afstand],[pt_slag],[pt_beschrijving_catego"
                        "rie])"
                End
                Begin Label
                    Left =415
                    Top =250
                    Width =1695
                    Height =225
                    FontSize =8
                    FontWeight =700
                    Name ="Text2"
                    Caption ="Vereniging"
                End
                Begin Label
                    Left =3061
                    Top =250
                    Width =390
                    Height =225
                    FontSize =8
                    FontWeight =700
                    Name ="lbST"
                    Caption ="Pnt."
                End
                Begin Label
                    Left =4006
                    Top =250
                    Width =465
                    Height =225
                    FontSize =8
                    FontWeight =700
                    Name ="lbTot"
                    Caption ="Tot."
                End
                Begin TextBox
                    Visible = NotDefault
                    Left =5329
                    TabIndex =1
                    Name ="PT_Is_InitVals"
                    ControlSource ="PT_Is_InitVals"
                End
                Begin TextBox
                    Visible = NotDefault
                    Left =4896
                    Width =951
                    TabIndex =2
                    Name ="PT_Is_Estaf"
                    ControlSource ="PT_Is_Estaf"
                    GUID = Begin
                        0xcd0fdb86a2ff1041b6d9cddd552e5e3d
                    End
                End
            End
        End
        Begin BreakHeader
            KeepTogether = NotDefault
            CanShrink = NotDefault
            Height =240
            BreakLevel =4
            OnFormat ="[Event Procedure]"
            Name ="scCatHeader"
            Begin
                Begin TextBox
                    CanShrink = NotDefault
                    FontItalic = NotDefault
                    TextAlign =1
                    Width =5031
                    FontSize =8
                    Name ="catVarCatBes"
                    ControlSource ="=nz([PT_pnt_beschrijvingcategorie],\"\")"
                End
            End
        End
        Begin Section
            KeepTogether = NotDefault
            Height =241
            OnFormat ="[Event Procedure]"
            Name ="scDetail"
            Begin
                Begin TextBox
                    Left =415
                    Width =2541
                    Height =241
                    FontSize =8
                    Name ="fldVereniging"
                    ControlSource ="pt_Vereniging"
                End
                Begin TextBox
                    TextAlign =1
                    Left =3061
                    Width =696
                    Height =241
                    FontSize =8
                    TabIndex =1
                    Name ="fldSubtot"
                    ControlSource ="=fmtPnt(nz([PT_Subtotaal]),True)"
                End
                Begin TextBox
                    TextAlign =1
                    Left =4006
                    Width =681
                    Height =241
                    FontSize =8
                    TabIndex =2
                    Name ="fldTot"
                    ControlSource ="=fmtPnt(nz([PT_Cumulatief]),True)"
                    Format ="0"
                End
                Begin TextBox
                    TextAlign =1
                    Width =396
                    FontSize =8
                    TabIndex =3
                    Name ="fldTeller"
                    ControlSource ="=[pt_rankingDisplay]"
                End
                Begin TextBox
                    Visible = NotDefault
                    Left =5442
                    Width =951
                    TabIndex =4
                    Name ="PT_Cumulatief"
                    ControlSource ="PT_Cumulatief"
                    GUID = Begin
                        0x0f4ee2d17408d843894c513216529e97
                    End
                End
            End
        End
        Begin BreakFooter
            KeepTogether = NotDefault
            Height =0
            BreakLevel =4
            Name ="scCatFooter"
        End
        Begin BreakFooter
            KeepTogether = NotDefault
            Height =0
            BreakLevel =3
            Name ="scProgFooter"
        End
        Begin PageFooter
            Height =256
            OnFormat ="[Event Procedure]"
            Name ="scPageFooter"
            Begin
                Begin TextBox
                    TextAlign =3
                    Left =8655
                    Width =1806
                    Height =256
                    FontSize =8
                    FontWeight =700
                    Name ="Field38"
                    ControlSource ="=\"Pagina \" & [Page] & \"/\" & [Pages]"
                End
                Begin Label
                    TextAlign =2
                    Left =6870
                    Width =870
                    Height =256
                    FontSize =8
                    FontWeight =700
                    Name ="fldAppName"
                    Caption ="Hupprog"
                End
                Begin TextBox
                    TextAlign =1
                    Width =6276
                    Height =256
                    FontSize =8
                    FontWeight =700
                    TabIndex =1
                    Name ="fldFooter"
                End
            End
        End
        Begin FormFooter
            KeepTogether = NotDefault
            Height =0
            Name ="scRepFooter"
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

Option Compare Database   'Use database order for string comparisons
Option Explicit

Private wedInfo As WED_BASIC_INFO
Private pntInfo As PNT_GLOBAL_BASIC_INFO
Private pntCalcMode As Integer
Private blIsVerPnt As Boolean
Private pntVerPntOpts As PNT_VER_PNT_OPTIONS
Private pntVerSecOpts As PNT_VER_SEC_OPTIONS
Private nDisplayComp As Integer
Private blDisplayNaam As Boolean
Private blHideZero As Boolean
Private blIsSmall As Boolean
Private blIsEindUitslag As Boolean



Private Function rpcIsSmall() As Boolean
rpcIsSmall = True
End Function


'below is standard stuff

Private Sub Report_Open(Cancel As Integer)
On Error Resume Next
initReport
End Sub

Private Sub scCatHeader_Format(Cancel As Integer, FormatCount As Integer)
On Error Resume Next
If blIsEindUitslag Then
  Cancel = True
End If
End Sub

Private Sub scDetail_Format(Cancel As Integer, FormatCount As Integer)
On Error GoTo fout

If Nz(Me.PT_Cumulatief) < 1 Then
  If (blHideZero) Then
    Cancel = True
    Exit Sub
  End If
End If

'If Me.fldTeller.value > 50000 Then
'  Me.fldTeller.Visible = False
'Else
'  Me.fldTeller.Visible = True
'End If


Dim i As Integer

Dim blIsInit As Boolean
blIsInit = Nz(Me.PT_Is_InitVals)

If (Not blIsSmall) Then

  'hide everything
  For i = 1 To nDisplayComp
    Me.Controls("t" & i).Visible = (Not blIsEindUitslag) And (Not blIsInit)
    Me.Controls("p" & i).Visible = (Not blIsEindUitslag) And (Not blIsInit)
    If (blDisplayNaam) Then
      Me.Controls("d" & i).Visible = (Not blIsEindUitslag) And (Not blIsInit)
    End If
  Next i
  
End If



If (Not blIsSmall) And (Not blIsEindUitslag) Then

  For i = 1 To nDisplayComp
    Dim tpTijd As Double
    Dim tpPnt As Double
    Dim tpEst As Integer
    Dim tpNm As String
    Dim tpIsVVT As Boolean
    Dim tpIsDis As Boolean
  
    tpTijd = Nz(Me.Controls("ft" & i).value)
    tpPnt = Nz(Me.Controls("fp" & i).value)
    tpNm = Nz(Me.Controls("fnm" & i).value)
    tpEst = Nz(Me.Controls("fest" & i).value)
  
    tpIsVVT = Nz(Me.Controls("fIsV" & i).value)
    tpIsDis = Nz(Me.Controls("fIsD" & i).value)
  
  
  
    Me.Controls("t" & i).value = pntDisplayTijd(tpTijd, tpIsVVT, tpIsDis)
    Me.Controls("p" & i).value = fmtPnt(tpPnt, True)
  
    If (blDisplayNaam) Then
      If (Nz(Me.PT_Is_Estaf)) Then
        If (tpEst > 0) Then
          Me.Controls("d" & i).value = Me.fldVereniging.value & " " & tpEst
        Else
          Me.Controls("d" & i).value = ""
        End If
      Else
        Me.Controls("d" & i).value = tpNm
      End If
    End If
  
  Next i
  
End If 'if not blSmall

Me.fldSubTot.Visible = (Not blIsInit) And (Not blIsEindUitslag)

Exit Sub
fout:
MsgBox Err & " scDetail_format" & vbCrLf & Error$, 16
Exit Sub

End Sub



Private Sub scPageFooter_Format(Cancel As Integer, FormatCount As Integer)
On Error Resume Next
Me.fldFooter = wedInfo.des & ", " & rxpFormatDateNL(wedInfo.date) & " te " & wedInfo.Plaats
Me.fldAppName = appGetName()
End Sub

Private Sub scProgHeader_Format(Cancel As Integer, FormatCount As Integer)
On Error Resume Next
Dim blIsInit As Boolean
blIsInit = Nz(Me.PT_Is_InitVals)

Dim i As Integer
If (Not blIsSmall) Then
  For i = 1 To nDisplayComp
    Me.Controls("lbT" & i).Visible = (Not blIsInit) And (Not blIsEindUitslag)
    Me.Controls("lbP" & i).Visible = (Not blIsInit) And (Not blIsEindUitslag)
  Next i
End If

Me.lbST.Visible = (Not blIsInit) And (Not blIsEindUitslag)

Me.fldProgDes.Visible = (Not blIsInit) And (Not blIsEindUitslag)
Me.lbTussenstand.Visible = blIsInit


  
End Sub


Private Sub initReport()
On Error GoTo fout


blIsSmall = rpcIsSmall()

Dim wednr As Long
Dim pntOrderID As Long

Dim lastWednr As Long
Dim lastProg As String
Dim lastPntCatIdx As Integer
Dim maxNComp As Integer
Dim isVerPnt As Boolean

Dim optProgSingle As String
Dim optProgStart As String
Dim optProgEnd As String
Dim optIsEindUitslag As Boolean
Dim optVerSingle As String

wednr = Nz(DLookup("PT_PNT_Wedstrijdnummer", "__punten_Stats"))
pntOrderID = Nz(DLookup("PT_PNT_OrderID", "__punten_Stats"))
pntCalcMode = Nz(DLookup("PT_PNT_CalcMode", "__punten_Stats"))
lastWednr = Nz(DLookup("PT_LAST_WEdstrijdnummer", "__punten_Stats"))
lastProg = Nz(DLookup("PT_Last_Programmanummer", "__punten_Stats"))
lastPntCatIdx = Nz(DLookup("PT_LAST_PNT_CatIdx", "__punten_stats"))
maxNComp = Nz(DLookup("PT_Max_NComp", "__punten_Stats"))

optIsEindUitslag = Nz(DLookup("PT_OPT_IsEindUitslag", "__punten_Stats"))
optProgSingle = Nz(DLookup("PT_OPT_ProgSingle", "__punten_Stats"))
optProgStart = Nz(DLookup("PT_OPT_ProgStart", "__punten_Stats"))
optProgEnd = Nz(DLookup("PT_OPT_ProgEnd", "__punten_Stats"))
optVerSingle = Nz(DLookup("PT_OPT_VerSingle", "__punten_stats"))

Dim sqlWhereClause As String
sqlWhereClause = ""

If (optIsEindUitslag) Then
  blIsEindUitslag = True
  sqlWhereClause = "WHERE pt_programmanummer = """ & lastProg & """ and pt_wedstrijdnummer = " & lastWednr & " and pt_pnt_CatIdx =" & lastPntCatIdx & ""
ElseIf (optProgSingle <> "") Then
  sqlWhereClause = "Where pt_programmanummer = """ & optProgSingle & """"
ElseIf (optProgStart <> "") Or (optProgEnd <> "") Then
  'range
  Dim stProg As Long
  Dim endprog As Long
  stProg = -9999
  endprog = 1000000
  If (optProgStart <> "") Then
    stProg = val(optProgStart)
  End If
  
  If (optProgEnd <> "") Then
    endprog = val(optProgEnd)
  End If
  
  sqlWhereClause = "WHERE Val([pt_programmanummer]) Between " & stProg & " and " & endprog
End If

If (optVerSingle <> "") Then
  If (sqlWhereClause <> "") Then
    sqlWhereClause = sqlWhereClause & " and "
  Else
    sqlWhereClause = "Where "
  End If
  
  sqlWhereClause = sqlWhereClause & " pt_vereniging =""" & optVerSingle & """"
End If

Dim sql As String
sql = "SELECT * FROM __punten " & _
      sqlWhereClause & " " & _
     "ORDER BY pt_wedstrijdnummer, Val([pt_programmanummer]), PT_Programmanummer"
     

Me.RecordSource = sql



Dim isFnd As Boolean

If Not wedLookup(wednr, isFnd, wedInfo) Then
  Exit Sub
End If

If Not isFnd Then
  Err.Raise 1, , "Kon wedstrijd: " & wednr & " niet vinden."
End If


If Not pntGlobalLookup(wednr, pntOrderID, isFnd, pntInfo) Then
  Exit Sub
End If

If (Not isFnd) Then
  Err.Raise 1, , "Kon puntentelling: ( " & wednr & " , " & pntOrderID & " ) niet vinden."
End If

isVerPnt = (pntInfo.Type = PNT_TYPE_VER_PNT)

If (isVerPnt) Then
  If Not pntVerPntLookup(wednr, pntOrderID, isFnd, pntVerPntOpts) Then
    Exit Sub
  End If
Else
  If Not pntVerSecLookup(wednr, pntOrderID, isFnd, pntVerSecOpts) Then
    Exit Sub
  End If
End If

If (Not isFnd) Then
  Err.Raise 1, , "Kon puntentelling: ( " & wednr & " , " & pntOrderID & " ) niet vinden."
End If

nDisplayComp = maxNComp
If (nDisplayComp > 4) Then
  nDisplayComp = 4
End If


If (nDisplayComp < 1) Then
  nDisplayComp = 1
End If

If Not blIsSmall Then
  Dim i As Integer
  For i = 1 To nDisplayComp
    Me.Controls("ft" & i).ControlSource = "PT_Actual_Tijd_" & i
    Me.Controls("fp" & i).ControlSource = "PT_Punten_" & i
    Me.Controls("fnm" & i).ControlSource = "PT_Naam_" & i
    Me.Controls("fest" & i).ControlSource = "PT_Estafettenummer_" & i
    Me.Controls("fIsV" & i).ControlSource = "PT_Is_VVT_" & i
    Me.Controls("fIsD" & i).ControlSource = "PT_Is_Dis_" & i
  Next i
End If
  

blDisplayNaam = True
If (nDisplayComp > 2) Then
  blDisplayNaam = False
End If



If Not blIsSmall Then
  'Have to set all the sizes.
  Dim links As Long
  links = CLng(4.5 * 567)
  Dim rechts As Long
  rechts = CLng(16.1 * 567)

  Dim tpRoom As Long
  tpRoom = (rechts - links) \ nDisplayComp

  Dim tWidth As Long
  Dim pWidth As Long
  Dim nWidth As Long
  If (blDisplayNaam) Then
    tWidth = CLng(tpRoom * 0.3) - 5
    pWidth = CLng(tpRoom * 0.2) - 5
    nWidth = CLng(tpRoom * 0.5) - 5
  Else
   tWidth = CLng(tpRoom * 0.6) - 5
   pWidth = CLng(tpRoom * 0.4) - 5
  End If

  'Hide everything.
  For i = 1 To 4
    Me.Controls("t" & i).Visible = False
    Me.Controls("lbT" & i).Visible = False
    Me.Controls("p" & i).Visible = False
    Me.Controls("lbP" & i).Visible = False
    Me.Controls("d" & i).Visible = False
  Next i


  For i = 1 To nDisplayComp
    Dim tpLeft As Double
    tpLeft = links + (i - 1) * tpRoom
    Me.Controls("t" & i).Left = tpLeft
    Me.Controls("t" & i).Width = tWidth
    Me.Controls("t" & i).Visible = True
  
    Me.Controls("lbT" & i).Left = Me.Controls("t" & i).Left
    Me.Controls("lbT" & i).Width = Me.Controls("t" & i).Width
    Me.Controls("lbT" & i).Visible = True
  
    Me.Controls("p" & i).Left = tpLeft + tWidth
    Me.Controls("p" & i).Width = pWidth
    Me.Controls("p" & i).Visible = True
  
    Me.Controls("lbP" & i).Left = Me.Controls("p" & i).Left
    Me.Controls("lbP" & i).Width = Me.Controls("p" & i).Width
    Me.Controls("lbP" & i).Visible = True
  
  
    If (blDisplayNaam) Then
      Me.Controls("d" & i).Left = tpLeft + tWidth + pWidth
      Me.Controls("d" & i).Width = nWidth
      Me.Controls("d" & i).Visible = True
    End If
  Next i
End If 'if not blsmall



blHideZero = True


If (Not blIsSmall) And blIsEindUitslag Then
  Me.lbTot.Left = Me.lbTot.Left - 2 * 567
  Me.fldTot.Left = Me.lbTot.Left
End If




If (db_narrow() Or ((nDisplayComp = 4) And Not blIsSmall)) Then
    Dim ctl As Control
    For Each ctl In Me.Section(acDetail).Controls
            ctl.FontName = "Arial Narrow"
    Next ctl
End If

Exit Sub
fout:
MsgBox Err & " initOptions" & vbCrLf & Error$, 16
Exit Sub
End Sub

Private Sub scRepHeader_Format(Cancel As Integer, FormatCount As Integer)
On Error Resume Next
Dim sTitle As String
sTitle = pntInfo.des

If (pntCalcMode = PNT_CALC_MODE_ESTIMATE) Then
  sTitle = "( ! SCHATTING (via inschrijftijden) ! ) " & sTitle
ElseIf (pntCalcMode = PNT_CALC_MODE_TEST) Then
  sTitle = "( ! TEST (via inschrijftijden) ! ) " & sTitle
End If

Me.fldTitle.value = sTitle
End Sub